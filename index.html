<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>COG Viewer</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    #map { width: 100%; height: 100vh; }
    .info {
      background: white;
      padding: 10px;
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 1000;
    }
  </style>
</head>
<body>
<div id="map"></div>
<div class="info" id="info">Click on map</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
    const year = 2025;

    // Initialize the map and set its view
    const map = L.map('map', {maxZoom: 28}).setView([-21.085198, 55.222047], 13); // Paris coordinates

    // Add OpenStreetMap tiles
    L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
      attribution: '&copy; OpenStreetMap contributors',
      maxZoom: 28
    }).addTo(map);

  const tileLayer = L.tileLayer(`http://localhost:8000/pred/${year}/{z}/{x}/{y}.png`, {
    tileSize: 256,
    attribution: 'COG Tiles',
    maxZoom: 28
  }).addTo(map);

  // map.on('click', async (e) => {
  //   const { lat, lng } = e.latlng;
  //   const response = await fetch(`http://localhost:8000/depth?lon=${lng}&lat=${lat}&year=${year}`);
  //   const data = await response.json();

  //   if (data.depth === null) { return; }

  //   document.getElementById('info').innerHTML = `Depth: ${data.depth.toFixed(2)} m`;
  // });

  map.on('click', async (e) => {
    const { lat, lng } = e.latlng;
    const response = await fetch(`http://localhost:8000/prediction?lon=${lng}&lat=${lat}&year=${year}`);
    const data = await response.json();

    if (data.pred === null) { return; }

    document.getElementById('info').innerHTML = `Pred: ${data.pred}`;
  });
</script>
</body>
</html>
